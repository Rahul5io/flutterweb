name: Flutter CI/CD

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repo
      uses: actions/checkout@v2
    - name: Setup Java
      uses: actions/setup-java@v2
      with:
        distribution: 'temurin' # Use 'temurin' distribution for Java setup
        java-version: '12'
    - name: Setup Flutter
      uses: subosito/flutter-action@v1
      with:
        flutter-version: '3.16.5' # Use the correct Flutter version
    - name: Get Flutter Dependencies
      run: flutter pub get
    - name: Build Flutter Web App
      run: flutter build web
    - name: Deploy to Firebase
      uses: FirebaseExtended/action-hosting-deploy@v0
      with:
        repoToken: "${{ secrets.GITHUB_TOKEN }}"
        firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT_FLUTTER_WEB }}"
        channelId: live # Use 'live' to deploy to the live channel
      env:
        FIREBASE_CLI_PREVIEWS: true
